## ğŸ¯ ã‚´ãƒ¼ãƒ«

* **é‡è¤‡ãƒ»å¤šé‡ãƒã‚¹ãƒˆã‚’ä¸€æƒ**ã—ã¦ãƒ‘ã‚¹è¿·å­ã‚’é˜²ã
* Dataâ€Š/â€ŠMLâ€Š/â€ŠServiceâ€Šã®ä¸‰è·èƒ½ã‚’ â€œå±¤â€ ã ã‘ã§åˆ†é›¢
* 1 ãƒ•ã‚¡ã‚¤ãƒ« 1 å½¹å‰²ã‚’å®ˆã‚Šã€`import` ãŒæœ€çŸ­ã«ãªã‚‹ã‚ˆã†æ•´ç†

---

## 1. ææ¡ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ„ãƒªãƒ¼ï¼ˆ35 è¡Œï¼‰

```
fullstack-dwh-mlops/
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ Makefile                     # dbtãƒ»DuckDBâ†’MLâ†’CI ã¾ã§ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰
â”œâ”€â”€ pyproject.toml               # ä¾å­˜ & isort/black å…±é€šè¨­å®š
â”‚
â”œâ”€â”€ configs/                     # ğŸšš ã™ã¹ã¦ *.yaml ã«çµ±ä¸€
â”‚   â”œâ”€â”€ app.yaml
â”‚   â”œâ”€â”€ envs/{dev,stg,prd}.yaml
â”‚   â”œâ”€â”€ ml/{model,ensemble,training}.yaml
â”‚   â””â”€â”€ requirements/{base,dev,prod}.txt
â”‚
â”œâ”€â”€ infra/                       # â€œå®Ÿè¡Œç’°å¢ƒâ€ ã‚’ä¸¸ã”ã¨
â”‚   â”œâ”€â”€ docker/docker-compose.yaml
â”‚   â”œâ”€â”€ mlflow/docker-compose.yaml
â”‚   â””â”€â”€ metabase/{Dockerfile,setup.sh,plugins/*}
â”‚
â”œâ”€â”€ docs/                        # è¨­è¨ˆ & ADR ç½®ãå ´
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ data-pipeline.md
â”‚   â”œâ”€â”€ gold-table.md
â”‚   â””â”€â”€ how_to_import.md
â”‚
â”œâ”€â”€ src/                         # === Python import root ===
â”‚   â”œâ”€â”€ core/{__init__,config,logging,exceptions}.py
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                    # â˜… Data Engineering
â”‚   â”‚   â”œâ”€â”€ raw/house_data.csv
â”‚   â”‚   â”œâ”€â”€ ingestion/__init__.py
â”‚   â”‚   â”œâ”€â”€ warehouse/
â”‚   â”‚   â”‚   â”œâ”€â”€ duckdb/house.duckdb
â”‚   â”‚   â”‚   â””â”€â”€ dbt_project/â€¦    # models/{bronze,silver,gold}
â”‚   â”‚   â””â”€â”€ validation/__init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ml/                      # â˜… ML Engineering
â”‚   â”‚   â”œâ”€â”€ features/__init__.py
â”‚   â”‚   â”œâ”€â”€ models/{train_model,train_ensemble}.py
â”‚   â”‚   â””â”€â”€ pipeline/train_pipeline.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                # â˜… Serving / UI
â”‚   â”‚   â”œâ”€â”€ api_fastapi/{main.py,schemas.py,helpers.py}
â”‚   â”‚   â””â”€â”€ ui_streamlit/app.py
â”‚   â”‚
â”‚   â””â”€â”€ tests/                   # unit / integration / e2e
â”‚
â””â”€â”€ scripts/                     # ãƒªãƒå¤–ã‹ã‚‰ã‚‚å†åˆ©ç”¨ã§ãã‚‹ãƒ¯ãƒ³ã‚ªãƒ•
    â”œâ”€â”€ create_dwh.py
    â””â”€â”€ verify_dwh.py
```

### å¤‰æ›´ãƒã‚¤ãƒ©ã‚¤ãƒˆ

| Before                   | After                                      | ç†ç”±                                           |
| ------------------------ | ------------------------------------------ | -------------------------------------------- |
| `deployment/`            | **`infra/`**                               | â€œç’°å¢ƒâ€ å…¨èˆ¬ã‚’é›†ç´„ï¼ˆDockerãƒ»K8sãƒ»IaCï¼‰                   |
| `src/data/dwh/dwh/*`     | **`src/data/warehouse/dbt_project`**       | å¾ªç’°ãƒã‚¹ãƒˆã‚’é™¤å»ãƒ»`warehouse` ç›´ä¸‹ã¸                     |
| `src/ml/data/dwh/â€¦` ã®ã‚³ãƒ”ãƒ¼ | ğŸ”¥ **å‰Šé™¤**                                  | Data ãƒ¬ã‚¤ãƒ¤ã¯ **ä¸€å…ƒåŒ–**ã€ML ã‹ã‚‰ã¯ duckdb æ¥ç¶šã§å‚ç…§        |
| `requirements*.txt` æ•£åœ¨   | `configs/requirements/{base,dev,prod}.txt` | ä¾å­˜ãƒ„ãƒªãƒ¼ã‚’ãƒ¯ãƒ³ãƒ—ãƒ¬ã‚¤ã‚¹ã«                                |
| äºŒé‡ `ml/` & `models/`     | `src/ml` ã¸çµ±åˆ                               | â€œãƒ¢ãƒ‡ãƒ«å®šç¾© vs å­¦ç¿’ã‚³ãƒ¼ãƒ‰â€ ã‚’ `/ml/models` å†…ã§åˆ†ã‘ã‚‹æ–¹ãŒèª­ã¿ã‚„ã™ã„ |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ—¥æœ¬èªãƒ•ã‚¡ã‚¤ãƒ«å           | `docs/*.md` è‹±æ•°å­—                            | OS ä¾å­˜ãƒã‚°ï¼†CI è­¦å‘Šã‚’é˜²æ­¢                             |

---

## 2. ãƒªãƒãƒ¼ãƒ ï¼ç§»å‹•ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆæŠœç²‹ï¼‰

| ç§»å‹•å‰                                           | ç§»å‹•å¾Œ                                      |
| --------------------------------------------- | ---------------------------------------- |
| `deployment/docker/docker-compose.yaml`       | `infra/docker/docker-compose.yaml`       |
| `deployment/metabase` å…¨ä½“                      | `infra/metabase`                         |
| `src/data/dwh/dwh/house_price_dbt`            | `src/data/warehouse/dbt_project`         |
| `src/ml/data/raw`                             | `src/data/raw`                           |
| `src/ml/data/dwh/data/house_price_dwh.duckdb` | `src/data/warehouse/duckdb/house.duckdb` |
| `src/ml/models/train_model.py`                | `src/ml/models/train_model.py` â€»ãƒ‘ã‚¹ã¯åŒã˜    |
| `docs/æ±ç”¨ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨­è¨ˆæ›¸.md`                   | `docs/data-pipeline.md`                  |

> **Tip:**
> `git mv OLD NEW` ã§å±¥æ­´ã‚’ä¿ã£ãŸã¾ã¾ç§»å‹•ã™ã‚‹ã¨ PR Diff ãŒæœ€å°ã«ãªã‚Šã¾ã™ã€‚

---

## 3. ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹å½±éŸ¿

```python
# æ—§
from src.ml.data.dwh.core.database import DuckDBClient
# æ–°
from src.data.warehouse.core.database import DuckDBClient
```

`sed` ä¸€ç™ºç½®æ›ä¾‹:

```bash
find src -type f -name "*.py" \
  -exec sed -i 's/src\.ml\.data\.dwh/src.data.warehouse/g' {} +
```

---

## 4. CI/CD å¤‰æ›´ç‚¹

1. **PYTHONPATH** ã« `src/` ã ã‘é€šã›ã° OKï¼ˆå¤šé‡ãƒã‚¹ãƒˆè§£æ¶ˆï¼‰
2. `DB_PATH` ã‚’ `src/data/warehouse/duckdb/house.duckdb` ã¸æ›´æ–°
3. lint ç„¡åŠ¹åŒ–æ–¹é‡ã¯æ®ãˆç½®ãã€`pytest -q` ã¨ `dbt test` ã ã‘å®Ÿè¡Œæ¨å¥¨

---

## 5. ç§»è¡Œãƒ•ãƒ­ãƒ¼ï¼ˆå®‰å…¨æ‰‹é †ï¼‰

1. **ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚‹**  â†’ `git checkout -b refactor/dir-layout`
2. ä¸Šè¨˜ **`git mv`** ã§ç‰©ç†ç§»å‹•
3. `sed` or `pytest --collect-only` ã§ import ã‚¨ãƒ©ãƒ¼ã‚’æ´—ã„æ›¿ãˆ
4. CI é€šéã‚’ç¢ºèªã—ã¦ `main` ã¸ãƒãƒ¼ã‚¸

---

### ã¾ã¨ã‚

* â€œ**Data / ML / Service**â€ ã¨ã„ã† 3 éšå±¤ã§ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ°´å¹³åˆ†å‰²
* äºŒé‡ `dwh/dwh` ã‚„ ML å´ã®ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼ã‚’ **æ’é™¤**ã—ã€å˜ä¸€ã‚½ãƒ¼ã‚¹åŒ–
* ã“ã‚Œã§ **ãƒ‘ã‚¹åã¯æœ€çŸ­ï¼•ã‚»ã‚°ãƒ¡ãƒ³ãƒˆä»¥ä¸‹**ã€VSCode ã®æ¤œç´¢çµæœã‚‚æ¿€æ¸›ã—ã¾ã™ã€‚

äº†è§£ã§ã™ã€‚**æ¨è«– APIï¼UI ã¯ Kaggle ã‚³ãƒ³ãƒšã«ã¯ä¸è¦**ãªã®ã§ `src/services` ã‚’ä¸¸ã”ã¨å‰Šé™¤ã—ãŸã‚·ãƒ³ãƒ—ãƒ«æ§‹æˆã«æ›´æ–°ã—ã¾ã™ã€‚

---

## æœ€å°æ§‹æˆãƒ„ãƒªãƒ¼ï¼ˆ32 è¡Œï¼‰

```
fullstack-dwh-mlops/
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ Makefile
â”œâ”€â”€ pyproject.toml
â”‚
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ app.yaml
â”‚   â”œâ”€â”€ envs/{dev,stg,prd}.yaml
â”‚   â”œâ”€â”€ ml/{model,ensemble,training}.yaml
â”‚   â””â”€â”€ requirements/{base,dev,prod}.txt
â”‚
â”œâ”€â”€ infra/                      # Kaggle ã§ã¯ä½¿ã‚ãªãã¦ã‚‚å‰Šé™¤ä¸è¦
â”‚   â”œâ”€â”€ docker/docker-compose.yaml
â”‚   â”œâ”€â”€ mlflow/docker-compose.yaml
â”‚   â””â”€â”€ metabase/â€¦
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ data-pipeline.md
â”‚   â”œâ”€â”€ gold-table.md
â”‚   â””â”€â”€ how_to_import.md
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/{__init__,config,logging,exceptions}.py
â”‚   â”‚
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ raw/house_data.csv
â”‚   â”‚   â”œâ”€â”€ ingestion/__init__.py
â”‚   â”‚   â”œâ”€â”€ warehouse/
â”‚   â”‚   â”‚   â”œâ”€â”€ duckdb/house.duckdb
â”‚   â”‚   â”‚   â””â”€â”€ dbt_project/â€¦        # bronze / silver / gold
â”‚   â”‚   â””â”€â”€ validation/__init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ml/
â”‚   â”‚   â”œâ”€â”€ features/__init__.py
â”‚   â”‚   â”œâ”€â”€ models/{train_model,train_ensemble}.py
â”‚   â”‚   â””â”€â”€ pipeline/train_pipeline.py
â”‚   â”‚
â”‚   â””â”€â”€ tests/                       # unit / integration / e2e
â”‚
â””â”€â”€ scripts/
    â”œâ”€â”€ create_dwh.py
    â””â”€â”€ verify_dwh.py
```

### å¤‰æ›´ç‚¹

| å‰Šé™¤å¯¾è±¡                                                           | å½±éŸ¿                                                                                           |
| -------------------------------------------------------------- | -------------------------------------------------------------------------------------------- |
| `src/services/api_fastapi/*` <br>`src/services/ui_streamlit/*` | Kaggle ã‚«ãƒ¼ãƒãƒ«ã¯ notebook å®Ÿè¡Œã®ã¿ã€‚æ¨è«–ã¯ notebook å†…ã§ç›´æ¥å‘¼ã³å‡ºã™ã‹ã€`ml` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® predict é–¢æ•°ã‚’ import ã—ã¦åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚ |

ãã®ã»ã‹ã®ãƒ•ã‚©ãƒ«ãƒ€ã¯ **å­¦ç¿’ãƒ»æ¤œè¨¼ã«å¿…é ˆ**ãªã®ã§æ®‹ã—ã¦ã„ã¾ã™ã€‚CI ã‚„ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼ã§ Serving ãŒå¿…è¦ã«ãªã£ãŸå ´åˆã¯ã€`services` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ¥ãƒ–ãƒ©ãƒ³ãƒã§ä¿æŒã—ã¦ãŠãã¨å®‰å…¨ã§ã™ã€‚
